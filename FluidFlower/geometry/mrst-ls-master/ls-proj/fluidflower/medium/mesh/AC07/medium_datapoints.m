%% Make datapoints for mesh conforming to boundary, fault, folded layers
%
% We draw the stratigraphy using paths in inkscape (model_lines.svg). 
% Then, we export nodes
% by selecting a given path and then doing extensions>export>export XY. Finally,
% we transform the y values using the actual y location (in mm) of the 
% leftmost node, since they are initially not absolute coordinates that we
% want. The extension export XY is external and was downloaded from here
% https://alpha.inkscape.org/vectors/www.inkscapeforum.com/viewtopicdb3f.html?t=8826
% and added to inkscape.
%

% Boundary
h = 47; % height (cm)
l = 89.7; % length
to_m = 1e-2; % convert measuring/drawing units (cm) to m
stratiPoints = struct('boundary', [], 'lines', [], 'wells', []);
stratiPoints.boundary = to_m*[0, 0; ...
                              l, 0; ...
                              l, -h; ...
                              0, -h; ...
                              0, 0];

% transforms
yn = @(y) -h + y;
%                                       %top %actual y coord leftmost node
to_mesh = @(vals, yl) to_m*[vals(:,1) -cumsum([h-yl; diff(vals(:,2))])];
                          
% Wells (to have cells with correct centroids)
stratiPoints.wells{1} = to_m*[l-45, yn(2)];
stratiPoints.wells{2} = to_m*[l-16.5, yn(16)];
stratiPoints.wells{3} = to_m*[l-8, yn(8)];
stratiPoints.wells{4} = to_m*[l-81.7, yn(8)];
stratiPoints.wells{5} = to_m*[l-7.9, yn(16)];
stratiPoints.wells{6} = to_m*[l-24.3, yn(24.3)];
stratiPoints.wells{7} = to_m*[l-2, yn(2)];
stratiPoints.wells{8} = to_m*[l-87.7, yn(2)];

% Fault lines (1 fault, 2 lines are shear zone boundaries)
stratiPoints.lines{1} = to_mesh([78.184671,297.0
                                77.841771,294.94009
                                77.580511,293.16028
                                77.351911,291.20085
                                77.221281,290.49872
                                76.829401,289.06181
                                76.535481,287.52692
                                76.189771,285.28123
                                75.944841,283.8035
                                75.698,282.20025
                                75.480069,280.9995
                                75.343501,280.22805
                                75.148,278.968
                                74.951891,277.70719
                                74.808384,276.3137
                                74.744054,275.53654
                                74.603734,274.42
                                74.501584,273.34279], 0);
                          
stratiPoints.lines{2} = to_mesh([80.470671,297.0
                                80.389071,295.65855
                                80.242111,295.07072
                                80.225811,294.40125
                                80.209511,293.37255
                                80.087051,291.95196
                                79.931931,290.92326
                                79.539941,289.14345
                                79.270211,288.4912
                                79.178161,288.04108
                                78.646891,284.96316
                                78.461961,283.96515
                                77.776531,280.88119
                                77.417301,278.75848
                                77.063031,276.77437
                                76.818101,275.51701
                                76.437531,273.46797], 0);
                                 
stratiPoints.lines{3} = [stratiPoints.lines{2}(end-1, 1), stratiPoints.lines{2}(end-1, 2)
                        76.096645,21.365-h
                        75.478583,21.173-h
                        stratiPoints.lines{1}(end-3, 1), stratiPoints.lines{1}(end-3, 2)];
stratiPoints.lines{3}(2:3, :) = stratiPoints.lines{3}(2:3, :)*to_m;
                            
stratiPoints.lines{4} = [stratiPoints.lines{1}(end,1), stratiPoints.lines{1}(end,2); ...
                         stratiPoints.lines{2}(end,1), stratiPoints.lines{2}(end,2)]; % fault closure

% Layer lines (top to bottom and left to right)
% FW
stratiPoints.lines{5} = to_mesh([75.944841,283.8035
                                        75.344451,283.41093
                                        74.744061,283.13383
                                        73.982021,283.06453
                                        73.243071,283.20308
                                        72.342481,283.4571
                                        71.187881,283.84966
                                        69.917811,284.28841
                                        68.809391,284.68098
                                        67.654791,285.09664
                                        66.569461,285.51229
                                        65.553411,285.85868
                                        64.375711,286.03186
                                        63.313481,286.29742
                                        61.777851,286.5168
                                        60.265321,286.73617
                                        59.087621,286.87473
                                        58.071571,286.68999
                                        57.101701,286.50525
                                        56.131841,286.50525
                                        54.907961,286.38979
                                        53.406971,286.18197
                                        51.698161,285.97413
                                        50.289539,285.7894
                                        49.573685,285.62775
                                        47.655271,285.49375
                                        46.087728,285.2978
                                        44.487528,285.13452
                                        42.919986,284.93857
                                        41.254471,284.70997
                                        39.817559,284.41606
                                        37.923444,284.08949
                                        35.787708,283.94203
                                        33.547778,283.80348
                                        31.492582,283.68802
                                        30.268701,283.64182
                                        29.321924,283.64182
                                        28.559887,283.54942
                                        27.774754,283.54942
                                        26.504691,283.50322
                                        25.488638,283.64178
                                        24.795876,283.68798
                                        23.317982,283.59558
                                        21.816997,283.66488
                                        20.431471,283.78034
                                        18.035244,283.8935
                                        15.91253,284.15475
                                        14.181701,284.38335
                                        13.234644,284.38335
                                        12.156959,284.38335
                                        10.88333,284.48135
                                        9.5770438,284.6773
                                        8.2707588,284.9059
                                        6.9644728,285.23247
                                        5.9521018,285.52638
                                        4.9723868,285.88561
                                        3.6334448,286.53875
                                        2.3924728,287.35518
                                        1.3147868,288.07364
                                        0.0,289.08601], ...
                                 stratiPoints.lines{1}(9,2)/to_m + h);



stratiPoints.lines{6} = to_mesh([75.69800,282.20025
                                75.351941,281.95778
                                74.751551,281.69222
                                73.908691,281.47284
                                72.892641,281.32275
                                72.067101,281.47862
                                71.287741,281.55362
                                70.144681,281.88846
                                68.955431,282.16556
                                67.685371,282.67359
                                66.750141,283.08925
                                65.560901,283.44717
                                64.210011,283.87438
                                63.124681,284.20921
                                61.508241,284.59023
                                60.053441,284.82115
                                59.129751,284.9597
                                58.055971,284.78651
                                57.097651,284.71721
                                56.023871,284.69411
                                54.742261,284.55556
                                53.345181,284.37082
                                51.671011,284.22072
                                50.481771,283.95516
                                49.660016,283.81057
                                47.787788,283.63038
                                46.09778,283.48342
                                44.49758,283.32013
                                42.995353,283.12419
                                41.342784,282.88728
                                39.917418,282.68574
                                38.034849,282.37071
                                35.979936,282.26944
                                33.370531,282.14243
                                31.772056,282.02876
                                30.466533,281.94996
                                29.552411,281.93366
                                28.741389,281.87396
                                27.874614,281.84126
                                26.71885,281.79506
                                25.768113,281.81936
                                24.944722,281.86556
                                23.4505,281.78956
                                21.986133,281.73846
                                19.538372,281.83086
                                17.41925,281.96711
                                15.504365,282.13601
                                14.466298,282.27224
                                13.380689,282.29534
                                12.349187,282.38774
                                11.445032,282.50881
                                10.000194,282.65857
                                8.6477242,282.81789
                                7.3414382,283.09828
                                6.2597912,283.39219
                                5.2800772,283.75142
                                4.0796862,284.24292
                                2.7001622,285.01316
                                1.4146472,285.77781
                                0.0,286.79016], ...
                                  stratiPoints.lines{1}(10,2)/to_m + h);
                     
stratiPoints.lines{7} = to_mesh([75.480069,280.9995
                                75.087499,280.61848
                                74.723799,280.49147
                                73.880939,280.2721
                                72.897549,280.2363
                                71.972049,280.35951
                                71.259989,280.35251
                                70.116929,280.55671
                                68.911359,280.83382
                                67.575979,281.12957
                                66.542779,281.59422
                                65.500489,282.06644
                                64.214919,282.39568
                                62.949979,282.74684
                                61.268219,283.06254
                                59.829749,283.27714
                                59.036689,283.49733
                                58.109869,283.48733
                                57.069899,283.51603
                                55.996119,283.49293
                                54.714509,283.35437
                                52.809409,282.93872
                                51.747179,282.76552
                                50.881219,282.66161
                                49.678451,282.50547
                                47.656124,282.34837
                                46.058486,282.14368
                                44.527561,281.93421
                                43.036883,281.72672
                                41.349675,281.52446
                                39.866577,281.32291
                                37.891639,281.1118
                                35.675082,280.91816
                                32.999883,280.69632
                                31.72798,280.69685
                                30.520427,280.64865
                                29.537029,280.61405
                                28.645185,280.53995
                                27.773626,280.51885
                                26.644919,280.51485
                                25.58186,280.55145
                                24.281941,280.56045
                                22.002588,280.57675
                                19.718452,280.50255
                                18.09046,280.47945
                                16.652554,280.55795
                                15.551665,280.67488
                                14.484734,280.85152
                                13.572315,281.01895
                                12.411246,281.15371
                                11.180519,281.2911
                                9.7520092,281.46535
                                8.1382822,281.68182
                                7.0116112,281.93772
                                6.2075492,282.19081
                                5.2686562,282.59902
                                3.7253662,283.30279
                                2.6397562,283.89343
                                1.3868992,284.57654
                                0.0,285.58889], ...
                                  stratiPoints.lines{1}(11,2)/to_m + h);

stratiPoints.lines{8} = to_mesh([74.603734,274.42
                                74.004746,274.31493
                                73.184636,274.24643
                                72.357116,274.20633
                                71.351136,274.37936
                                70.436676,274.76318
                                69.247436,275.35053
                                68.173316,275.72793
                                67.107456,276.06194
                                66.195796,276.33822
                                65.024526,276.65113
                                63.514656,277.01862
                                62.126816,277.22003
                                60.769986,277.4836
                                59.895286,277.62215
                                58.690876,277.69395
                                57.667236,277.62465
                                56.348526,277.51991
                                54.854646,277.64261
                                53.668006,277.61881
                                52.426156,277.57621
                                51.364256,277.45596
                                50.079845,277.41416
                                48.13916,277.20808
                                46.263936,276.93808
                                44.912627,276.53266
                                43.389291,276.06392
                                41.179568,275.43711
                                39.320913,274.95798
                                37.41129,274.64889
                                35.68309,274.38651
                                33.474756,274.04564
                                31.884446,273.9237
                                30.856505,273.9735
                                29.922095,273.9878
                                29.324163,273.9627
                                28.452605,274.0069
                                27.356555,273.9703
                                26.081222,274.0396
                                24.422075,274.0486
                                22.110065,274.22821
                                20.315786,274.36628
                                18.883737,274.47381
                                17.543802,274.63397
                                16.459242,274.7509
                                15.294339,274.86223
                                14.218634,274.88273
                                12.992251,274.91953
                                11.908482,275.02426
                                10.659586,275.2475
                                9.2418015,275.54561
                                7.9518445,275.88315
                                7.1641115,276.08726
                                5.5394185,276.31586
                                4.2083995,276.62775
                                2.8288745,277.00611
                                1.5923465,277.65656
                                0.0,278.26069], ...
                                stratiPoints.lines{1}(16,2)/to_m + h);

stratiPoints.lines{9} = to_mesh([70.43564,273.23844
                                70.34437,273.61652
                                68.197706,274.17541
                                67.082856,274.41145
                                65.779316,274.72039
                                64.624376,274.919
                                62.869576,275.40079
                                61.449076,275.79814
                                59.928956,276.07804
                                58.841986,276.13494
                                57.686566,276.05974
                                56.437946,276.00484
                                55.425866,276.11435
                                54.029946,275.99212
                                52.761666,276.00112
                                50.964646,275.92592
                                49.52719,275.822
                                47.720264,275.71485
                                46.416392,275.52509
                                45.406583,275.28775
                                44.120586,274.88233
                                42.59725,274.46257
                                40.240572,273.83576
                                38.757474,273.48726
                                37.027464,273.14552
                                35.127856,272.90658
                                33.49098,272.74637
                                32.349705,272.71427
                                31.076839,272.68247
                                30.028126,272.61517
                                28.82604,272.57377
                                27.480951,272.60167
                                26.270602,272.67937
                                25.370828,272.55272
                                24.201538,272.51242
                                22.477355,272.57772
                                20.07892,272.71579
                                18.630543,272.88864
                                17.404907,272.98344
                                16.222375,273.14936
                                15.008489,273.32601
                                13.736839,273.46077
                                12.657413,273.56288
                                11.573645,273.66761
                                10.53702,273.82553
                                9.3641638,274.042
                                8.3354648,274.26524
                                7.1395168,274.53467
                                5.9556958,274.64897
                                3.9388768,275.07515
                                2.3797378,275.60047
                                1.0778948,276.16928
                                0.0,276.56115], ...
                                23.762);
                              
% HW
stratiPoints.lines{10} = to_mesh(flipud([89.7,289.42978
                                        88.585971,289.11079
                                        87.851181,288.63726
                                        86.936781,288.35968
                                        86.316301,288.13108
                                        85.205951,287.98412
                                        83.964981,287.95142
                                        82.903621,287.78814
                                        81.972901,287.59219
                                        81.107481,287.59219
                                        79.948151,288.34331
                                        79.539941,289.14341]), ...
                                stratiPoints.lines{2}(8,2)/to_m + h);

stratiPoints.lines{11} = to_mesh([79.178161,288.04108
                                79.904201,287.64914
                                80.116471,287.17561
                                80.067471,286.57145
                                80.247081,286.22855
                                81.210471,285.68971
                                82.271821,285.3958
                                83.349511,285.2815
                                84.116951,285.3958
                                85.227291,285.75503
                                86.304981,286.0816
                                87.447981,286.40817
                                87.986821,286.55513
                                88.852241,286.91435
                                89.7,287.15928], ...
                                stratiPoints.lines{2}(10,2)/to_m + h);
  
stratiPoints.lines{12} = to_mesh(flipud([89.7,285.28139
                                        89.107331,285.17748
                                        88.403021,284.99274
                                        87.814181,284.75028
                                        86.832761,284.43853
                                        86.463291,284.28844
                                        85.932171,284.12679
                                        85.458781,283.93051
                                        84.962301,283.87281
                                        84.327271,283.75735
                                        83.530591,283.69965
                                        82.473391,283.75705
                                        81.814061,283.83055
                                        81.090821,283.91755
                                        80.361401,284.05074
                                        79.863371,284.17857
                                        79.312991,284.51529
                                        78.875501,284.74272
                                        78.646891,284.96316]), ...
                                stratiPoints.lines{2}(11,2)/to_m + h);
                            
stratiPoints.lines{13} = to_mesh(flipud([89.7,277.67125
                                        89.021391,277.51125
                                        88.287571,277.34086
                                        87.664081,277.12989
                                        87.005951,276.77196
                                        86.370921,276.51795
                                        85.504971,276.22929
                                        84.835301,276.03301
                                        83.790401,275.79459
                                        82.761701,275.63131
                                        81.618701,275.54971
                                        80.671641,275.53341
                                        79.887871,275.50071
                                        79.153081,275.59871
                                        78.581581,275.81098
                                        78.108051,276.03958
                                        77.569211,276.43147
                                        77.063031,276.77437]), ...
                                stratiPoints.lines{2}(15,2)/to_m + h);
                            
stratiPoints.lines{14} = to_mesh(flipud([89.7,276.07218
                                        88.933901,275.81092
                                        88.166451,275.59865
                                        87.203071,275.33739
                                        86.288671,275.07614
                                        85.651851,274.94551
                                        84.786441,274.76589
                                        84.019001,274.61894
                                        83.251551,274.43932
                                        81.684011,274.29237
                                        80.426711,274.17807
                                        79.512311,274.17807
                                        78.255011,274.48831
                                        77.454911,274.96184
                                        76.818101,275.51701]), ...
                                stratiPoints.lines{2}(16,2)/to_m + h);
                           
                  
% Above
stratiPoints.lines{15} = to_mesh(flipud([89.7,274.60261
                                        88.346071,274.30869
                                        87.154081,274.06377
                                        85.913111,273.85149
                                        84.394551,273.72087
                                        82.647401,273.65557
                                        80.573671,273.55757
                                        77.879451,273.55757
                                        76.437531,273.46797
                                        74.501591,273.34274
                                        72.209311,273.26764
                                        70.43564,273.23844
                                        66.498441,273.24744
                                        63.347031,273.26374
                                        60.652811,273.21474
                                        58.464781,273.16574
                                        55.721581,273.06774
                                        51.214901,273.26368
                                        49.075859,273.19838
                                        46.871911,272.95025
                                        44.42415,272.62696
                                        41.491453,272.30367
                                        38.558758,271.86492
                                        34.522685,271.23023
                                        30.883418,270.9221
                                        26.86716,270.74561
                                        24.626384,270.63644
                                        20.745787,270.83074
                                        17.177808,270.99534
                                        14.568402,271.03424
                                        11.995897,271.12334
                                        9.8719878,271.31428
                                        7.6329348,271.75255
                                        5.8050958,272.03738
                                        3.4238098,272.75255
                                        1.7033078,273.26408
                                        0.0,274.10812]), 22.892);

stratiPoints.lines{16} = to_mesh([0.0,265.09938
                                1.3637728,264.85445
                                3.5191448,264.4544
                                6.3603158,263.8829
                                7.4706588,263.71145
                                8.7606158,263.40121
                                9.6586868,263.25425
                                10.964973,263.00932
                                11.79773,263.00932
                                13.316287,262.69908
                                14.08373,262.63378
                                15.062561,262.66268
                                15.813054,262.67418
                                17.013843,262.55872
                                18.653381,262.60492
                                19.761801,262.48946
                                21.562984,262.30473
                                22.648312,262.23543
                                23.8491,262.32783
                                25.581007,262.53566
                                27.405282,262.6973
                                28.698439,262.7435
                                29.876134,262.6742
                                31.123107,262.90512
                                32.069884,262.85892
                                33.085934,262.95132
                                34.540735,262.85892
                                35.92626,262.90512
                                38.445959,263.15624
                                39.752244,263.12354
                                41.352444,263.15624
                                43.703759,263.58078
                                44.814101,263.61348
                                47.100101,263.94005
                                47.851216,263.80942
                                50.594411,264.00537
                                53.043701,264.42991
                                54.676561,264.42991
                                56.309411,264.62585
                                60.130301,264.78914
                                63.722581,264.91977
                                66.638731,265.14509
                                70.610581,265.19129
                                73.358531,265.35293
                                76.799251,265.37603
                                80.863461,265.81478
                                83.449771,265.97643
                                85.620431,266.18426
                                88.068191,266.62301
                                89.7,267.08485], 31.901);
                            
stratiPoints.lines{17} = to_mesh([0.0,260.5977
                                1.4020108,260.37586
                                3.3033698,259.92962
                                5.7288838,259.38122
                                7.5088968,259.00194
                                8.7526698,258.87643
                                9.9278468,258.79873
                                11.234132,258.73853
                                12.367086,258.59998
                                13.608538,258.49756
                                14.491442,258.43226
                                15.193168,258.34576
                                16.197674,258.21876
                                17.283002,258.14946
                                18.437606,258.17256
                                19.776947,258.08016
                                21.393393,257.9647
                                22.617274,257.8723
                                23.714148,257.8838
                                25.099673,258.09163
                                27.002647,258.10203
                                28.557061,258.18083
                                29.930699,258.29117
                                31.096029,258.34247
                                32.173437,258.37797
                                33.222142,258.45397
                                34.187085,258.54117
                                35.735898,258.63637
                                37.488154,258.92015
                                39.582654,258.99125
                                41.229037,259.09319
                                42.725943,259.33299
                                44.482867,259.41179
                                46.445575,259.59981
                                47.797085,259.65391
                                49.524232,259.80367
                                51.442401,259.90492
                                53.444731,259.95112
                                55.562521,260.10088
                                58.764281,260.43865
                                62.797441,260.55295
                                64.603241,260.69664
                                68.248511,260.75914
                                73.282471,260.92078
                                76.723191,260.94388
                                80.901701,261.10504
                                83.488011,261.26669
                                85.658671,261.47451
                                88.106431,261.91326
                                89.7,262.37511], 36.402);

                            
% Corrections
stratiPoints.lines{15}(end-9,:) = stratiPoints.lines{1}(end,:);
stratiPoints.lines{15}(end-8,:) = stratiPoints.lines{2}(end,:);
stratiPoints.lines{15}(end-11,:) = stratiPoints.lines{9}(1,:);
stratiPoints.lines{8}(1,:) = stratiPoints.lines{1}(end-1, :);

% Add Cf division
stratiPoints.lines{18} = [stratiPoints.lines{1}(13, 1), stratiPoints.lines{1}(13, 2)
                         stratiPoints.lines{2}(end-3, 1), stratiPoints.lines{2}(end-3, 2)];

% Save data
save('mesh_datapoints.mat', 'stratiPoints');